btn btn-secondary" onclick="prevOnboarding()" style="display: none;">Anterior</button>
                <button id="onboardingNext" class="btn btn-primary" onclick="nextOnboarding()">Comenzar</button>
            </div>
            <div style="display: flex; justify-content: center; margin-top: 1rem; gap: 0.25rem;">
                <div class="onboarding-dot active" data-step="0"></div>
                <div class="onboarding-dot" data-step="1"></div>
                <div class="onboarding-dot" data-step="2"></div>
                <div class="onboarding-dot" data-step="3"></div>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <div class="nav-item active" onclick="setActiveTab('calculator')">
            <div style="font-size: 1.25rem;">üßÆ</div>
            <div style="font-size: 0.75rem;">Calcular</div>
        </div>
        <div class="nav-item" onclick="setActiveTab('history')">
            <div style="font-size: 1.25rem;">üìö</div>
            <div style="font-size: 0.75rem;">Historial</div>
        </div>
        <div class="nav-item" onclick="setActiveTab('settings')">
            <div style="font-size: 1.25rem;">‚öôÔ∏è</div>
            <div style="font-size: 0.75rem;">Config</div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentFunc = 'sin';
        let centerPoint = 0;
        let numTerms = 3;
        let inputValue = 1;
        let themeColor = '#dc2626';
        let darkMode = false;
        let onboardingStep = 0;
        let history = [];

        // Funciones matem√°ticas
        const functions = {
            sin: {
                name: 'sin(x)',
                formula: 'sin(x) = x - x¬≥/3! + x‚Åµ/5! - x‚Å∑/7! + ...',
                calculate: (x, a, n) => {
                    let result = 0;
                    let terms = [];
                    for (let i = 0; i < n; i++) {
                        const power = 2 * i + 1;
                        const coeff = Math.pow(-1, i) / factorial(power);
                        const term = coeff * Math.pow(x - a, power);
                        result += term;
                        terms.push({
                            term: i + 1,
                            value: term,
                            formula: `${i % 2 === 0 ? '+' : '-'}(x-${a})^${power}/${power}!`
                        });
                    }
                    return { result, terms };
                },
                realValue: (x) => Math.sin(x),
                uses: 'Procesamiento de se√±ales, animaciones, simulaciones f√≠sicas, GPS',
                description: 'Fundamental en trigonometr√≠a y ondas. Se usa en videojuegos para movimientos suaves, en procesamiento de audio para an√°lisis de frecuencias, y en simulaciones f√≠sicas para movimientos pendulares.'
            },
            cos: {
                name: 'cos(x)',
                formula: 'cos(x) = 1 - x¬≤/2! + x‚Å¥/4! - x‚Å∂/6! + ...',
                calculate: (x, a, n) => {
                    let result = 0;
                    let terms = [];
                    for (let i = 0; i < n; i++) {
                        const power = 2 * i;
                        const coeff = Math.pow(-1, i) / factorial(power);
                        const term = coeff * Math.pow(x - a, power);
                        result += term;
                        terms.push({
                            term: i + 1,
                            value: term,
                            formula: `${i % 2 === 0 ? '+' : '-'}(x-${a})^${power}/${power}!`
                        });
                    }
                    return { result, terms };
                },
                realValue: (x) => Math.cos(x),
                uses: 'Gr√°ficos 3D, rotaciones, an√°lisis de frecuencias',
                description: 'Esencial en geometr√≠a y f√≠sica. Se usa en gr√°ficos 3D para rotaciones, en sistemas de navegaci√≥n para c√°lculo de posiciones, y en ingenier√≠a para an√°lisis de vibraciones.'
            },
            x2: {
                name: 'x¬≤',
                formula: 'x¬≤ = a¬≤ + 2a(x-a) + (x-a)¬≤',
                calculate: (x, a, n) => {
                    let result = 0;
                    let terms = [];
                    const coeffs = [a*a, 2*a, 1];
                    for (let i = 0; i < Math.min(n, 3); i++) {
                        const term = coeffs[i] * Math.pow(x - a, i);
                        result += term;
                        terms.push({
                            term: i + 1,
                            value: term,
                            formula: `${coeffs[i]}(x-${a})^${i}`
                        });
                    }
                    return { result, terms };
                },
                realValue: (x) => x * x,
                uses: 'F√≠sica (energ√≠a cin√©tica), geometr√≠a, optimizaci√≥n',
                description: 'Funci√≥n cuadr√°tica b√°sica. Aparece en leyes f√≠sicas como la energ√≠a cin√©tica, en geometr√≠a para √°reas, y en optimizaci√≥n.'
            },
            exp: {
                name: 'eÀ£',
                formula: 'e^x = 1 + x + x¬≤/2! + x¬≥/3! + x‚Å¥/4! + ...',
                calculate: (x, a, n) => {
                    let result = 0;
                    let terms = [];
                    const ea = Math.exp(a);
                    for (let i = 0; i < n; i++) {
                        const coeff = ea / factorial(i);
                        const term = coeff * Math.pow(x - a, i);
                        result += term;
                        terms.push({
                            term: i + 1,
                            value: term,
                            formula: `e^${a}(x-${a})^${i}/${i}!`
                        });
                    }
                    return { result, terms };
                },
                realValue: (x) => Math.exp(x),
                uses: 'Crecimiento poblacional, inter√©s compuesto, machine learning',
                description: 'Base del crecimiento exponencial. Se usa en redes sociales para algoritmos virales, en finanzas para inter√©s compuesto, y en inteligencia artificial como funci√≥n de activaci√≥n.'
            },
            ln: {
                name: 'ln(x)',
                formula: 'ln(1+x) = x - x¬≤/2 + x¬≥/3 - x‚Å¥/4 + ...',
                calculate: (x, a, n) => {
                    if (a <= 0) a = 1;
                    let result = 0;
                    let terms = [];
                    const u = (x - a) / a;
                    for (let i = 1; i <= n; i++) {
                        const coeff = Math.pow(-1, i - 1) / i;
                        const term = coeff * Math.pow(u, i);
                        result += term;
                        terms.push({
                            term: i,
                            value: term,
                            formula: `${i % 2 === 1 ? '+' : '-'}((x-${a})/${a})^${i}/${i}`
                        });
                    }
                    return { result: Math.log(a) + result, terms };
                },
                realValue: (x) => Math.log(x),
                uses: 'Compresi√≥n de datos, escalas logar√≠tmicas, an√°lisis estad√≠stico',
                description: 'Inversa de la exponencial. Se usa en compresi√≥n de archivos, an√°lisis de datos con escalas logar√≠tmicas, y en qu√≠mica para c√°lculo de pH.'
            },
            sqrt: {
                name: '‚àöx',
                formula: '‚àöx = ‚àöa + (x-a)/(2‚àöa) - (x-a)¬≤/(8a^(3/2)) + ...',
                calculate: (x, a, n) => {
                    if (a <= 0) a = 1;
                    let result = 0;
                    let terms = [];
                    const sqrtA = Math.sqrt(a);
                    
                    result += sqrtA;
                    terms.push({ term: 1, value: sqrtA, formula: `‚àö${a}` });
                    
                    if (n > 1) {
                        const term1 = (x - a) / (2 * sqrtA);
                        result += term1;
                        terms.push({ term: 2, value: term1, formula: `(x-${a})/(2‚àö${a})` });
                    }
                    
                    if (n > 2) {
                        const term2 = -Math.pow(x - a, 2) / (8 * Math.pow(a, 1.5));
                        result += term2;
                        terms.push({ term: 3, value: term2, formula: `-(x-${a})¬≤/(8√ó${a}^(3/2))` });
                    }
                    
                    return { result, terms };
                },
                realValue: (x) => Math.sqrt(x),
                uses: 'Geometr√≠a, f√≠sica, estad√≠stica',
                description: 'Ra√≠z cuadrada. Fundamental en geometr√≠a para distancias, en f√≠sica para velocidades, y en estad√≠stica para desviaciones est√°ndar.'
            }
        };

        // Funciones auxiliares
        function factorial(n) {
            if (n <= 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }

        function vibrate(pattern = [50]) {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }

        // Funciones de UI
        function selectFunction(func) {
            currentFunc = func;
            document.querySelectorAll('.function-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('currentFunction').textContent = functions[func].name;
            updateCalculation();
            vibrate([30]);
        }

        function updateCenter(value) {
            centerPoint = parseFloat(value);
            document.getElementById('centerValue').textContent = value;
            updateCalculation();
            vibrate([10]);
        }

        function updateTerms(value) {
            numTerms = parseInt(value);
            document.getElementById('termsValue').textContent = value;
            updateCalculation();
            vibrate([10]);
        }

        function setInputToCenter() {
            inputValue = centerPoint;
            document.getElementById('inputValue').value = centerPoint;
            updateCalculation();
            vibrate([30]);
        }

        function updateCalculation() {
            inputValue = parseFloat(document.getElementById('inputValue').value) || 0;
            
            const func = functions[currentFunc];
            const calculation = func.calculate(inputValue, centerPoint, numTerms);
            const realValue = func.realValue(inputValue);
            const error = Math.abs(realValue - calculation.result);
            const errorPercent = (error / Math.abs(realValue)) * 100;
            const precision = 100 - errorPercent;

            // Update results
            document.getElementById('realValue').textContent = realValue.toFixed(6);
            document.getElementById('approxValue').textContent = calculation.result.toFixed(6);
            document.getElementById('errorValue').textContent = error.toFixed(6);
            document.getElementById('precisionValue').textContent = precision.toFixed(2) + '%';
            document.getElementById('precisionPercent').textContent = precision.toFixed(1) + '%';
            
            // Update precision bar
            const precisionFill = document.getElementById('precisionFill');
            precisionFill.style.width = Math.min(precision, 100) + '%';
            precisionFill.style.background = precision > 95 ? '#059669' : precision > 85 ? '#d97706' : '#dc2626';

            // Update terms
            updateTermsDisplay(calculation.terms);
            
            // Update chart
            updateChart();
        }

        function updateTermsDisplay(terms) {
            const container = document.getElementById('termsContainer');
            container.innerHTML = '';
            
            terms.forEach((term, index) => {
                const termDiv = document.createElement('div');
                termDiv.className = 'term-item';
                termDiv.innerHTML = `
                    <div class="term-number">${term.term}</div>
                    <div style="flex: 1;">
                        <div style="font-family: monospace; font-size: 0.875rem;">${term.formula}</div>
                        <div style="font-size: 0.75rem; color: #6b7280;">T√©rmino ${term.term}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-family: monospace; font-weight: bold;">${term.value.toFixed(6)}</div>
                        <div style="font-size: 0.75rem; color: #6b7280;">
                            ${Math.abs(term.value / functions[currentFunc].calculate(inputValue, centerPoint, numTerms).result * 100).toFixed(1)}%
                        </div>
                    </div>
                `;
                container.appendChild(termDiv);
            });
        }

        function updateChart() {
            const canvas = document.getElementById('chart');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set up chart parameters
            const width = canvas.width;
            const height = canvas.height;
            const padding = 40;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            const start = centerPoint - 2 * Math.PI;
            const end = centerPoint + 2 * Math.PI;
            const steps = 200;
            const stepSize = (end - start) / steps;
            
            // Calculate data points
            const realData = [];
            const approxData = [];
            let minY = Infinity, maxY = -Infinity;
            
            for (let i = 0; i <= steps; i++) {
                const x = start + i * stepSize;
                const real = functions[currentFunc].realValue(x);
                const approx = functions[currentFunc].calculate(x, centerPoint, numTerms).result;
                
                realData.push({ x, y: real });
                approxData.push({ x, y: approx });
                
                minY = Math.min(minY, real, approx);
                maxY = Math.max(maxY, real, approx);
            }
            
            // Add some padding to Y range
            const yRange = maxY - minY;
            minY -= yRange * 0.1;
            maxY += yRange * 0.1;
            
            // Helper function to convert data coordinates to canvas coordinates
            function toCanvasX(x) {
                return padding + (x - start) / (end - start) * chartWidth;
            }
            
            function toCanvasY(y) {
                return padding + (maxY - y) / (maxY - minY) * chartHeight;
            }
            
            // Draw grid
            ctx.strokeStyle = darkMode ? '#4b5563' : '#e5e7eb';
            ctx.lineWidth = 1;
            
            // Vertical grid lines
            for (let i = 0; i <= 10; i++) {
                const x = start + (end - start) * i / 10;
                const canvasX = toCanvasX(x);
                ctx.beginPath();
                ctx.moveTo(canvasX, padding);
                ctx.lineTo(canvasX, height - padding);
                ctx.stroke();
            }
            
            // Horizontal grid lines
            for (let i = 0; i <= 10; i++) {
                const y = minY + (maxY - minY) * i / 10;
                const canvasY = toCanvasY(y);
                ctx.beginPath();
                ctx.moveTo(padding, canvasY);
                ctx.lineTo(width - padding, canvasY);
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = darkMode ? '#9ca3af' : '#6b7280';
            ctx.lineWidth = 2;
            
            // X-axis (y = 0)
            if (minY <= 0 && maxY >= 0) {
                const zeroY = toCanvasY(0);
                ctx.beginPath();
                ctx.moveTo(padding, zeroY);
                ctx.lineTo(width - padding, zeroY);
                ctx.stroke();
            }
            
            // Y-axis (x = 0)
            if (start <= 0 && end >= 0) {
                const zeroX = toCanvasX(0);
                ctx.beginPath();
                ctx.moveTo(zeroX, padding);
                ctx.lineTo(zeroX, height - padding);
                ctx.stroke();
            }
            
            // Draw real function
            ctx.strokeStyle = '#2563eb';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(toCanvasX(realData[0].x), toCanvasY(realData[0].y));
            for (let i = 1; i < realData.length; i++) {
                ctx.lineTo(toCanvasX(realData[i].x), toCanvasY(realData[i].y));
            }
            ctx.stroke();
            
            // Draw approximation
            ctx.strokeStyle = themeColor;
            ctx.lineWidth = 3;
            ctx.setLineDash([8, 8]);
            ctx.beginPath();
            ctx.moveTo(toCanvasX(approxData[0].x), toCanvasY(approxData[0].y));
            for (let i = 1; i < approxData.length; i++) {
                ctx.lineTo(toCanvasX(approxData[i].x), toCanvasY(approxData[i].y));
            }
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Mark current point
            const currentX = toCanvasX(inputValue);
            const currentRealY = toCanvasY(functions[currentFunc].realValue(inputValue));
            const currentApproxY = toCanvasY(functions[currentFunc].calculate(inputValue, centerPoint, numTerms).result);
            
            // Real point
            ctx.fillStyle = '#2563eb';
            ctx.beginPath();
            ctx.arc(currentX, currentRealY, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            // Approx point
            ctx.fillStyle = themeColor;
            ctx.beginPath();
            ctx.arc(currentX, currentApproxY, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw center point
            const centerX = toCanvasX(centerPoint);
            ctx.strokeStyle = '#f59e0b';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(centerX, padding);
            ctx.lineTo(centerX, height - padding);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function setThemeColor(color) {
            themeColor = color;
            document.documentElement.style.setProperty('--theme-color', color);
            document.documentElement.style.setProperty('--theme-color-light', color + '20');
            
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateCalculation();
            vibrate([30]);
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark', darkMode);
            document.getElementById('theme-icon').textContent = darkMode ? '‚òÄÔ∏è' : 'üåô';
            updateCalculation();
            vibrate([30]);
        }

        function showExplanation() {
            const func = functions[currentFunc];
            document.getElementById('explanationTitle').textContent = func.name;
            document.getElementById('explanationContent').innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h4 style="font-weight: 600; margin-bottom: 0.5rem;">F√≥rmula de la Serie:</h4>
                    <div style="font-family: monospace; background: ${darkMode ? '#4b5563' : '#f3f4f6'}; padding: 1rem; border-radius: 0.5rem;">${func.formula}</div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <h4 style="font-weight: 600; margin-bottom: 0.5rem;">¬øPara qu√© sirve?</h4>
                    <p style="color: ${darkMode ? '#d1d5db' : '#4b5563'};">${func.description}</p>
                </div>
                <div>
                    <h4 style="font-weight: 600; margin-bottom: 0.5rem;">Aplicaciones:</h4>
                    <p style="color: ${darkMode ? '#d1d5db' : '#4b5563'};">${func.uses}</p>
                </div>
            `;
            document.getElementById('explanationModal').classList.remove('hidden');
            vibrate([50]);
        }

        function showUses() {
            const func = functions[currentFunc];
            document.getElementById('usesTitle').textContent = func.name;
            document.getElementById('usesContent').innerHTML = `
                <div style="margin-bottom: 1rem; padding: 1rem; background: #dbeafe; border-radius: 0.5rem; border: 1px solid #93c5fd;">
                    <h4 style="font-weight: 600; color: #1e40af; margin-bottom: 0.5rem;">En tu vida cotidiana:</h4>
                    <p style="color: #1e40af; font-size: 0.875rem;">${func.description}</p>
                </div>
                <div style="margin-bottom: 1rem; padding: 1rem; background: #d1fae5; border-radius: 0.5rem; border: 1px solid #86efac;">
                    <h4 style="font-weight: 600; color: #059669; margin-bottom: 0.5rem;">Aplicaciones tecnol√≥gicas:</h4>
                    <p style="color: #059669; font-size: 0.875rem;">${func.uses}</p>
                </div>
                <div style="padding: 1rem; background: ${darkMode ? '#4b5563' : '#f3f4f6'}; border-radius: 0.5rem;">
                    <h4 style="font-weight: 600; margin-bottom: 0.5rem;">¬øPor qu√© aproximaciones?</h4>
                    <p style="font-size: 0.875rem; color: ${darkMode ? '#d1d5db' : '#4b5563'};">
                        Las computadoras no pueden calcular valores exactos de funciones como ${func.name} directamente. 
                        En su lugar, usan estas aproximaciones de Taylor para obtener resultados muy precisos de forma r√°pida.
                    </p>
                </div>
            `;
            document.getElementById('usesModal').classList.remove('hidden');
            vibrate([50]);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function saveToHistory() {
            const func = functions[currentFunc];
            const calculation = func.calculate(inputValue, centerPoint, numTerms);
            const historyItem = {
                id: Date.now(),
                function: currentFunc,
                input: inputValue,
                center: centerPoint,
                terms: numTerms,
                result: calculation.result,
                timestamp: new Date().toLocaleTimeString()
            };
            history.unshift(historyItem);
            if (history.length > 10) history.pop();
            
            vibrate([50]);
            alert('¬°C√°lculo guardado en el historial! üìö');
        }

        function resetAll() {
            currentFunc = 'sin';
            centerPoint = 0;
            numTerms = 3;
            inputValue = 1;
            
            document.querySelectorAll('.function-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.function-btn').classList.add('active');
            document.getElementById('currentFunction').textContent = 'sin(x)';
            document.getElementById('centerSlider').value = 0;
            document.getElementById('centerValue').textContent = '0';
            document.getElementById('termsSlider').value = 3;
            document.getElementById('termsValue').textContent = '3';
            document.getElementById('inputValue').value = 1;
            
            updateCalculation();
            vibrate([50]);
        }

        function exportChart() {
            vibrate([50]);
            alert('üíæ Funci√≥n de exportar implementada - se descargar√≠a como imagen PNG');
        }

        function resetChart() {
            updateCalculation();
            vibrate([30]);
        }

        function setActiveTab(tab) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            vibrate([30]);
            
            if (tab === 'history') {
                alert('üìö Historial: ' + (history.length ? `${history.length} c√°lculos guardados` : 'No hay c√°lculos guardados'));
            } else if (tab === 'settings') {
                alert('‚öôÔ∏è Configuraci√≥n: Usa los controles del header para cambiar tema y colores');
            }
        }

        // Onboarding
        const onboardingSteps = [
            { title: '¬°Bienvenido a T-CAL!', text: 'Tu calculadora de Series de Taylor', action: 'Comenzar' },
            { title: 'Selecciona una funci√≥n', text: 'Toca cualquier funci√≥n matem√°tica', action: 'Siguiente' },
            { title: 'Ajusta par√°metros', text: 'Desliza para cambiar centro y t√©rminos', action: 'Siguiente' },
            { title: '¬°Listo para calcular!', text: 'Explora y disfruta aprendiendo', action: 'Empezar' }
        ];

        function nextOnboarding() {
            if (onboardingStep < onboardingSteps.length - 1) {
                onboardingStep++;
                updateOnboarding();
            } else {
                document.getElementById('onboarding').classList.add('hidden');
            }
            vibrate([50]);
        }

        function prevOnboarding() {
            if (onboardingStep > 0) {
                onboardingStep--;
                updateOnboarding();
            }
            vibrate([30]);
        }

        function updateOnboarding() {
            const step = onboardingSteps[onboardingStep];
            document.getElementById('onboardingTitle').textContent = step.title;
            document.getElementById('onboardingText').textContent = step.text;
            document.getElementById('onboardingNext').textContent = step.action;
            
            document.getElementById('onboardingPrev').style.display = onboardingStep > 0 ? 'block' : 'none';
            
            document.querySelectorAll('.onboarding-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === onboardingStep);
            });
        }

        // Gestures and touch events
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchmove', (e) => {
            if (!touchStartX || !touchStartY) return;
            
            const touchEndX = e.touches[0].clientX;
            const touchEndY = e.touches[0].clientY;
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            if (Math.abs(deltaX) > 50 && Math.abs(deltaX) > Math.abs(deltaY)) {
                const functions = Object.keys(functions);
                const currentIndex = functions.indexOf(currentFunc);
                
                if (deltaX > 0 && currentIndex > 0) {
                    // Swipe right - previous function
                    selectFunction(functions[currentIndex - 1]);
                } else if (deltaX < 0 && currentIndex < functions.length - 1) {
                    // Swipe left - next function
                    selectFunction(functions[currentIndex + 1]);
                }
                
                touchStartX = 0;
                touchStartY = 0;
            }
        });

        // Initialize
        function init() {
            // Set initial theme
            document.documentElement.style.setProperty('--theme-color', themeColor);
            document.documentElement.style.setProperty('--theme-color-light', themeColor + '20');
            
            // Add onboarding dots style
            const style = document.createElement('style');
            style.textContent = `
                .onboarding-dot {
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    background: #d1d5db;
                    transition: all 0.2s;
                }
                .onboarding-dot.active {
                    background: var(--theme-color, #dc2626);
                    transform: scale(1.2);
                }
            `;
            document.head.appendChild(style);
            
            // Initial calculation
            updateCalculation();
            
            // Auto-close onboarding after 15 seconds
            setTimeout(() => {
                document.getElementById('onboarding').classList.add('hidden');
            }, 15000);
        }

        // Start app
        document.addEventListener('DOMContentLoaded', init);

        // PWA Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,Ly8gU2ltcGxlIFNlcnZpY2UgV29ya2VyIGZvciBUYXlsb3IgQ2FsCmNvbnN0IENBQ0hFX05BTUUgPSAndGF5bG9yLWNhbC12Mi4wLjAnOwpjb25zdCB1cmxzVG9DYWNoZSA9IFsnLyddOwoKc2VsZ<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taylor Cal - Calculadora de Series de Taylor</title>
    <meta name="description" content="Calculadora interactiva de Series de Taylor con PWA">
    <meta name="theme-color" content="#dc2626">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVGF5bG9yIENhbCIsInNob3J0X25hbWUiOiJULUNBTCIsImRlc2NyaXB0aW9uIjoiQ2FsY3VsYWRvcmEgZGUgU2VyaWVzIGRlIFRheWxvciIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsInRoZW1lX2NvbG9yIjoiI2RjMjYyNiIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjJhV1YzUW05NFBTSXdJREFnTWpBd0lESXdNQ0lnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Memg0TUhrNWMzWm5JajRLUEhKbFkzUWdlRDBpTVRBaUlIazlJakV3SWlCM2FXUjBhRDBpTVRnd0lpQm9aV2xuYUhROUlqRTRNQ0lnY25nOUlqRXdJaUJtYVd4c1BTSWpaR015TmpJMklpOCtDand2YzNabklnPT0iLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    
    <!-- Estilos CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            padding: 1rem;
            transition: all 0.3s ease;
        }
        
        body.dark {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: #dc2626;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .logo {
            width: 80px;
            height: 80px;
            position: relative;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        
        .logo-circle {
            width: 100%;
            height: 100%;
            border: 3px solid rgba(255,255,255,0.8);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255,255,255,0.3); }
            50% { box-shadow: 0 0 30px rgba(255,255,255,0.6); }
        }
        
        .calculator-icon {
            width: 24px;
            height: 32px;
            background: linear-gradient(135deg, rgba(255,255,255,0.8), rgba(255,255,255,0.4));
            border-radius: 4px;
            position: relative;
            margin-bottom: 4px;
        }
        
        .calculator-icon::before {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            height: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 2px;
        }
        
        .calculator-icon::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 4px;
            right: 4px;
            top: 16px;
            background: repeating-linear-gradient(
                0deg,
                rgba(255,255,255,0.6) 0px,
                rgba(255,255,255,0.6) 3px,
                transparent 3px,
                transparent 6px
            );
        }
        
        .tcal-text {
            font-size: 10px;
            font-weight: bold;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255,255,255,0.8);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }
        
        .header-info h1 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        
        .header-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn:hover {
            transform: translateY(-1px);
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: #dc2626;
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: 1fr 1fr;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
        }
        
        .card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .dark .card {
            background: #374151;
            color: white;
        }
        
        .card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .function-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .function-btn {
            padding: 0.75rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            background: #f3f4f6;
            color: #374151;
        }
        
        .function-btn.active {
            background: var(--theme-color, #dc2626);
            color: white;
        }
        
        .function-btn:hover {
            background: #e5e7eb;
        }
        
        .function-btn.active:hover {
            opacity: 0.9;
        }
        
        .slider-container {
            margin: 1rem 0;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            outline: none;
            appearance: none;
            cursor: pointer;
        }
        
        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--theme-color, #dc2626);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--theme-color, #dc2626);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--theme-color, #dc2626);
        }
        
        .dark .input-field {
            background: #4b5563;
            border-color: #6b7280;
            color: white;
        }
        
        .results-grid {
            display: grid;
            gap: 0.75rem;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 0.5rem;
        }
        
        .dark .result-row {
            background: #4b5563;
        }
        
        .chart-container {
            height: 300px;
            margin: 1rem 0;
            background: #f9fafb;
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dark .chart-container {
            background: #4b5563;
        }
        
        .terms-container {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .term-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: #f9fafb;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .dark .term-item {
            background: #4b5563;
        }
        
        .term-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--theme-color, #dc2626);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem;
        }
        
        .color-picker {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .color-option.active {
            border-color: white;
            transform: scale(1.1);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .dark .modal-content {
            background: #374151;
            color: white;
        }
        
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 0.5rem;
            display: none;
        }
        
        .dark .mobile-nav {
            background: #374151;
            border-color: #6b7280;
        }
        
        @media (max-width: 768px) {
            .mobile-nav {
                display: flex;
                justify-content: space-around;
            }
            body {
                padding-bottom: 70px;
            }
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 60px;
        }
        
        .nav-item.active {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .precision-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .precision-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }
        
        .onboarding {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
        }
        
        .onboarding-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        .dark .onboarding-content {
            background: #374151;
            color: white;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hidden {
            display: none !important;
        }
        
        @media (max-width: 640px) {
            .header {
                padding: 1rem;
            }
            .header-info h1 {
                font-size: 1.25rem;
            }
            .logo {
                width: 60px;
                height: 60px;
            }
            .card {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div style="display: flex; align-items: center;">
                    <div class="logo">
                        <div class="logo-circle">
                            <div class="calculator-icon"></div>
                            <div class="tcal-text">T-CAL</div>
                        </div>
                    </div>
                    <div class="header-info">
                        <h1>Calculadora Taylor</h1>
                        <p style="opacity: 0.9; font-size: 0.875rem;">Linealizaci√≥n de funciones matem√°ticas</p>
                        <p style="opacity: 0.7; font-size: 0.75rem;">Taylor Cal - Herramienta Acad√©mica</p>
                    </div>
                </div>
                <div class="header-controls">
                    <button class="btn btn-secondary" onclick="toggleDarkMode()">
                        <span id="theme-icon">üåô</span>
                    </button>
                    <div class="color-picker">
                        <div class="color-option active" style="background: #dc2626;" onclick="setThemeColor('#dc2626')"></div>
                        <div class="color-option" style="background: #059669;" onclick="setThemeColor('#059669')"></div>
                        <div class="color-option" style="background: #7c3aed;" onclick="setThemeColor('#7c3aed')"></div>
                        <div class="color-option" style="background: #ea580c;" onclick="setThemeColor('#ea580c')"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid">
            <!-- Controls Panel -->
            <div>
                <!-- Function Selection -->
                <div class="card">
                    <h3 style="margin-bottom: 1rem; display: flex; align-items: center;">
                        üìö Funci√≥n f(x):
                        <span style="margin-left: 0.5rem; font-size: 0.75rem; opacity: 0.7;">‚Üê Toca funci√≥n ‚Üí</span>
                    </h3>
                    
                    <input type="text" 
                           class="input-field" 
                           placeholder="Ingresa tu funci√≥n..." 
                           id="customFunction"
                           style="margin-bottom: 1rem;">
                    
                    <div class="function-grid">
                        <button class="function-btn active" onclick="selectFunction('sin')">sin(x)</button>
                        <button class="function-btn" onclick="selectFunction('cos')">cos(x)</button>
                        <button class="function-btn" onclick="selectFunction('x2')">x¬≤</button>
                        <button class="function-btn" onclick="selectFunction('exp')">eÀ£</button>
                        <button class="function-btn" onclick="selectFunction('ln')">ln(x)</button>
                        <button class="function-btn" onclick="selectFunction('sqrt')">‚àöx</button>
                    </div>
                    
                    <div style="background: #f3f4f6; padding: 0.75rem; border-radius: 0.5rem;">
                        <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem;">Funci√≥n actual:</div>
                        <div id="currentFunction" style="font-family: monospace; font-size: 1.125rem; font-weight: bold; color: var(--theme-color, #dc2626);">sin(x)</div>
                    </div>
                </div>

                <!-- Parameters -->
                <div class="card" style="margin-top: 1rem;">
                    <h3 style="margin-bottom: 1rem;">Par√°metros</h3>
                    
                    <div class="slider-container">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                            Punto de centro (a): <span id="centerValue" style="color: var(--theme-color, #dc2626); font-weight: bold;">0</span>
                        </label>
                        <input type="range" class="slider" min="-3" max="3" step="0.1" value="0" 
                               id="centerSlider" onchange="updateCenter(this.value)">
                    </div>
                    
                    <div class="slider-container">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                            N√∫mero de t√©rminos: <span id="termsValue" style="color: var(--theme-color, #dc2626); font-weight: bold;">3</span>
                        </label>
                        <input type="range" class="slider" min="1" max="10" value="3" 
                               id="termsSlider" onchange="updateTerms(this.value)">
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Valor a evaluar (x):</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="number" class="input-field" value="1" step="0.1" 
                                   id="inputValue" onchange="updateCalculation()" style="flex: 1;">
                            <button class="btn btn-secondary" onclick="setInputToCenter()">= a</button>
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div class="card" style="margin-top: 1rem;">
                    <h3 style="margin-bottom: 1rem;">Resultados</h3>
                    <div class="results-grid">
                        <div class="result-row" style="background: #dbeafe;">
                            <span>Valor real:</span>
                            <span id="realValue" style="font-family: monospace; font-weight: bold;">0.841471</span>
                        </div>
                        <div class="result-row" style="background: var(--theme-color-light, #fef2f2);">
                            <span>Aproximaci√≥n:</span>
                            <span id="approxValue" style="font-family: monospace; font-weight: bold; color: var(--theme-color, #dc2626);">0.841667</span>
                        </div>
                        <div class="result-row" style="background: #fef3c7;">
                            <span>Error:</span>
                            <span id="errorValue" style="font-family: monospace; font-weight: bold; color: #d97706;">0.000196</span>
                        </div>
                        <div class="result-row" style="background: #d1fae5;">
                            <span>Precisi√≥n:</span>
                            <span id="precisionValue" style="font-family: monospace; font-weight: bold; color: #059669;">99.98%</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">
                            <span>Precisi√≥n</span>
                            <span id="precisionPercent">99.98%</span>
                        </div>
                        <div class="precision-bar">
                            <div id="precisionFill" class="precision-fill" style="width: 99.98%; background: #059669;"></div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="card" style="margin-top: 1rem;">
                    <h3 style="margin-bottom: 1rem;">Acciones</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                        <button class="btn" style="background: #dbeafe; color: #1e40af;" onclick="showExplanation()">
                            ‚ÑπÔ∏è Explicar
                        </button>
                        <button class="btn" style="background: #d1fae5; color: #059669;" onclick="showUses()">
                            üëÅÔ∏è Usos
                        </button>
                        <button class="btn" style="background: #e9d5ff; color: #7c3aed;" onclick="saveToHistory()">
                            üìù Guardar
                        </button>
                        <button class="btn" style="background: #f3f4f6; color: #374151;" onclick="resetAll()">
                            üîÑ Reset
                        </button>
                    </div>
                </div>
            </div>

            <!-- Visualization Panel -->
            <div>
                <!-- Chart -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Visualizaci√≥n</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn" style="background: #dbeafe; color: #1e40af; padding: 0.5rem;" onclick="exportChart()">
                                üíæ
                            </button>
                            <button class="btn" style="background: #f3f4f6; color: #374151; padding: 0.5rem;" onclick="resetChart()">
                                üîÑ
                            </button>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="chart" width="400" height="200"></canvas>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 1.5rem; margin-top: 1rem; font-size: 0.875rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 20px; height: 3px; background: #2563eb; border-radius: 2px;"></div>
                            <span>Funci√≥n real</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 20px; height: 3px; background: var(--theme-color, #dc2626); border-radius: 2px; background-image: repeating-linear-gradient(90deg, var(--theme-color, #dc2626) 0, var(--theme-color, #dc2626) 4px, transparent 4px, transparent 8px);"></div>
                            <span>Aproximaci√≥n Taylor</span>
                        </div>
                    </div>
                </div>

                <!-- Terms -->
                <div class="card" style="margin-top: 1rem;">
                    <h3 style="margin-bottom: 1rem;">T√©rminos de la Serie</h3>
                    <div class="terms-container" id="termsContainer">
                        <!-- Terms will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="explanationModal" class="modal hidden">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>Explicaci√≥n: <span id="explanationTitle">sin(x)</span></h3>
                <button onclick="closeModal('explanationModal')" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úï</button>
            </div>
            <div id="explanationContent">
                <!-- Content will be populated -->
            </div>
        </div>
    </div>

    <div id="usesModal" class="modal hidden">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>¬øD√≥nde se usa <span id="usesTitle">sin(x)</span>?</h3>
                <button onclick="closeModal('usesModal')" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úï</button>
            </div>
            <div id="usesContent">
                <!-- Content will be populated -->
            </div>
        </div>
    </div>

    <!-- Onboarding -->
    <div id="onboarding" class="onboarding">
        <div class="onboarding-content">
            <div style="margin-bottom: 1rem;">
                <div class="logo" style="margin: 0 auto 1rem;">
                    <div class="logo-circle">
                        <div class="calculator-icon"></div>
                        <div class="tcal-text">T-CAL</div>
                    </div>
                </div>
            </div>
            <h3 id="onboardingTitle">¬°Bienvenido a T-CAL!</h3>
            <p id="onboardingText" style="margin: 1rem 0; color: #6b7280;">Tu calculadora de Series de Taylor</p>
            <div style="display: flex; justify-content: center; gap: 0.75rem;">
                <button id="onboardingPrev" class="
