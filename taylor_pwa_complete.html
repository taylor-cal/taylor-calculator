const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `datos_linealizacion_${calculationResult.expr.replace(/[^a-zA-Z0-9]/g, '_')}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      showSuccess('üìä Datos CSV exportados exitosamente');
    }

    function shareResult() {
      if (!calculationResult) return;
      
      const text = `üßÆ Calculadora Taylor INACAP\n\n${generateShareText()}`;
      
      if (navigator.share) {
        navigator.share({
          title: 'Resultado de Linealizaci√≥n - INACAP',
          text: text,
          url: window.location.href
        }).catch(() => {
          copyToClipboard(text);
        });
      } else {
        copyToClipboard(text);
      }
    }

    function generateShareText() {
      if (!calculationResult) return '';
      
      const { expr, x0, m, b, unidadX, unidadY } = calculationResult;
      return `üìä Funci√≥n: f(x) = ${expr}\n` +
             `üìç Punto: x‚ÇÄ = ${formatNumber(x0)}\n` +
             `üìà Ecuaci√≥n lineal: y = ${formatNumber(m)}x + ${formatNumber(b)}\n` +
             `üìè Unidades: [${unidadY}] por [${unidadX}]\n\n` +
             `Calculado con Calculadora Taylor INACAP`;
    }

    function copyToClipboard(text) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          showSuccess('üìã Resultado copiado al portapapeles');
        }).catch(() => {
          fallbackCopyToClipboard(text);
        });
      } else {
        fallbackCopyToClipboard(text);
      }
    }

    function fallbackCopyToClipboard(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        document.execCommand('copy');
        showSuccess('üìã Resultado copiado al portapapeles');
      } catch (err) {
        showError('No se pudo copiar al portapapeles');
      } finally {
        document.body.removeChild(textArea);
      }
    }

    function descargarGrafico() {
      if (!currentPlot) return;
      
      const filename = `linealizacion_inacap_${calculationResult.expr.replace(/[^a-zA-Z0-9]/g, '_')}_x0_${calculationResult.x0.toString().replace('.', '_')}`;
      
      Plotly.downloadImage('grafico', {
        format: 'png',
        width: 1200,
        height: 800,
        filename: filename
      }).then(() => {
        showSuccess('üì• Gr√°fico descargado exitosamente');
      }).catch(() => {
        showError('No se pudo descargar el gr√°fico');
      });
    }

    // Funciones auxiliares
    function formatNumber(num) {
      if (Math.abs(num) < 1e-10) return '0';
      if (Math.abs(num) < 0.001 || Math.abs(num) > 10000) {
        return num.toExponential(3);
      }
      return parseFloat(num.toFixed(6)).toString();
    }

    function setFunction(func) {
      document.getElementById('funcion').value = func;
      document.getElementById('funcion').focus();
      
      const suggestions = {
        'sin(x)': '0',
        'cos(x)': '0',
        'exp(x)': '0',
        'log(x)': '1',
        'sqrt(x)': '1',
        'x^2': '1',
        'tan(x)': '0',
        '1/x': '1'
      };
      
      if (suggestions[func] && !document.getElementById('x0').value) {
        document.getElementById('x0').value = suggestions[func];
      }
    }

    function clearForm() {
      document.getElementById('calculatorForm').reset();
      document.getElementById('resultado').style.display = 'none';
      document.getElementById('graficoContainer').style.display = 'none';
      clearMessages();
      calculationResult = null;
      currentPlot = null;
    }

    function showError(mensaje) {
      const errorEl = document.createElement('div');
      errorEl.className = 'error';
      errorEl.innerHTML = `<strong>‚ùå Error:</strong> ${mensaje}`;
      errorEl.style.cssText = `
        background: linear-gradient(45deg, #f8d7da, #f1c2c3);
        color: #721c24;
        padding: 16px;
        border-radius: 10px;
        border-left: 4px solid #dc2626;
        margin-top: 15px;
        animation: shake 0.5s ease;
      `;
      
      const form = document.getElementById('calculatorForm');
      form.appendChild(errorEl);
      
      errorEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
      
      setTimeout(() => {
        if (errorEl.parentNode) {
          errorEl.parentNode.removeChild(errorEl);
        }
      }, 8000);
    }

    function showSuccess(mensaje) {
      const successEl = document.createElement('div');
      successEl.className = 'success';
      successEl.innerHTML = `<strong>${mensaje}</strong>`;
      successEl.style.cssText = `
        background: linear-gradient(45deg, #d4edda, #c3e6cb);
        color: #155724;
        padding: 16px;
        border-radius: 10px;
        border-left: 4px solid #059669;
        margin-top: 15px;
        animation: slideIn 0.3s ease;
      `;
      
      const form = document.getElementById('calculatorForm');
      form.appendChild(successEl);
      
      setTimeout(() => {
        if (successEl.parentNode) {
          successEl.parentNode.removeChild(successEl);
        }
      }, 4000);
    }

    function clearMessages() {
      const errors = document.querySelectorAll('.error, .success');
      errors.forEach(error => error.remove());
    }

    function toggleDarkMode() {
      const isDark = document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', isDark);
      updateToggleStyles();
      
      if (currentPlot) {
        const bgColor = isDark ? '#2a2a2a' : 'rgba(0,0,0,0)';
        const gridColor = isDark ? '#404040' : '#e1e5e9';
        
        Plotly.update('grafico', {}, {
          paper_bgcolor: bgColor,
          plot_bgcolor: bgColor,
          'xaxis.gridcolor': gridColor,
          'yaxis.gridcolor': gridColor
        });
      }
    }

    function updateToggleStyles() {
      const toggle = document.getElementById('darkModeToggle');
      const slider = toggle.nextElementSibling;
      const thumb = slider.nextElementSibling;
      
      if (toggle.checked) {
        slider.style.backgroundColor = '#0066cc';
        thumb.style.transform = 'translateX(26px)';
      } else {
        slider.style.backgroundColor = '#ccc';
        thumb.style.transform = 'translateX(0)';
      }
    }

    // Eventos de teclado
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && e.ctrlKey) {
        e.preventDefault();
        calcular();
      }
    });

    // Manejo de orientaci√≥n para m√≥viles
    window.addEventListener('orientationchange', function() {
      setTimeout(() => {
        if (currentPlot) {
          Plotly.Plots.resize('grafico');
        }
      }, 200);
    });

    window.addEventListener('resize', function() {
      if (currentPlot) {
        setTimeout(() => {
          Plotly.Plots.resize('grafico');
        }, 100);
      }
    });

    // Prevenir zoom en inputs (iOS)
    document.addEventListener('touchstart', function(e) {
      if (e.target.tagName === 'INPUT') {
        e.target.style.fontSize = '16px';
      }
    });

    // Auto-guardado del estado
    function saveState() {
      if (calculationResult) {
        const state = {
          expr: calculationResult.expr,
          x0: calculationResult.x0,
          unidadX: calculationResult.unidadX,
          unidadY: calculationResult.unidadY,
          timestamp: Date.now()
        };
        localStorage.setItem('calculatorState', JSON.stringify(state));
      }
    }

    function loadState() {
      try {
        const saved = localStorage.getItem('calculatorState');
        if (saved) {
          const state = JSON.parse(saved);
          const age = Date.now() - state.timestamp;
          
          if (age < 3600000) { // 1 hora
            document.getElementById('funcion').value = state.expr;
            document.getElementById('x0').value = state.x0;
            document.getElementById('unidadX').value = state.unidadX || '';
            document.getElementById('unidadY').value = state.unidadY || '';
          }
        }
      } catch (error) {
        console.log('No se pudo cargar el estado guardado');
      }
    }

    // Service Worker b√°sico para PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        const swCode = `
          const CACHE_NAME = 'inacap-taylor-calc-v2.1.0';
          const urlsToCache = [
            '/',
            'https://cdn.plot.ly/plotly-latest.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js'
          ];

          self.addEventListener('install', function(event) {
            event.waitUntil(
              caches.open(CACHE_NAME)
                .then(function(cache) {
                  return cache.addAll(urlsToCache);
                })
            );
          });

          self.addEventListener('fetch', function(event) {
            event.respondWith(
              caches.match(event.request)
                .then(function(response) {
                  if (response) {
                    return response;
                  }
                  return fetch(event.request);
                })
            );
          });
        `;
        
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        navigator.serviceWorker.register(swUrl)
          .then(function(registration) {
            console.log('Service Worker registrado para INACAP:', registration.scope);
          })
          .catch(function(error) {
            console.log('Error al registrar Service Worker:', error);
          });
      });
    }

    // Cargar estado al iniciar
    loadState();

    // Mensaje de bienvenida
    console.log('üéì Calculadora Taylor INACAP v2.1.0 iniciada');
    console.log('üì± PWA con funcionalidades: Offline, Instalable, Responsive');
    console.log('üèõÔ∏è Instituto Nacional de Capacitaci√≥n Profesional');

    // Interceptar el c√°lculo para guardar estado
    const originalCalcular = calcular;
    window.calcular = function() {
      originalCalcular();
      setTimeout(saveState, 1000);
    };
  </script>
</body>
</html>="exportToPDF()">üìÑ PDF</button>
        <button class="export-btn" onclick="exportToCSV()">üìä CSV</button>
        <button class="export-btn" onclick="shareResult()">üîó Compartir</button>
      </div>
    </div>

    <div class="graph-container" id="graficoContainer" style="display: none;">
      <div id="grafico"></div>
    </div>

    <!-- Toggle modo oscuro -->
    <div style="display: flex; align-items: center; justify-content: center; margin-top: 25px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 12px; backdrop-filter: blur(10px);">
      <span style="color: white;">üåô Modo oscuro</span>
      <label style="position: relative; display: inline-block; width: 60px; height: 34px; margin-left: 10px;">
        <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()" style="opacity: 0; width: 0; height: 0;">
        <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.4s; border-radius: 34px;"></span>
        <span style="position: absolute; content: ''; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: 0.4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></span>
      </label>
    </div>
  </div>

  <script>
    // Variables globales
    let currentPlot = null;
    let calculationResult = null;
    let currentPrecision = 5;
    let calculationStartTime = 0;

    // Configuraci√≥n inicial
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar preferencias
      const darkMode = localStorage.getItem('darkMode') === 'true';
      const savedTheme = localStorage.getItem('selectedTheme') || 'inacap';
      
      if (darkMode) {
        document.body.classList.add('dark-mode');
        document.getElementById('darkModeToggle').checked = true;
        updateToggleStyles();
      }
      
      // Aplicar tema guardado
      changeTheme(savedTheme);
      
      // Configurar Plotly para m√≥vil
      if (window.innerWidth < 768) {
        Plotly.setPlotConfig({
          responsive: true,
          displayModeBar: false
        });
      }

      // Manejar par√°metros URL
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('func')) {
        document.getElementById('funcion').value = urlParams.get('func');
      }
      if (urlParams.get('x0')) {
        document.getElementById('x0').value = urlParams.get('x0');
      }
    });

    // Funciones de tema
    function changeTheme(themeName) {
      // Remover clases de tema anteriores
      document.body.classList.remove('theme-inacap', 'theme-green', 'theme-purple', 'theme-red');
      
      // Agregar nueva clase de tema
      document.body.classList.add(`theme-${themeName}`);
      
      // Actualizar botones activos
      document.querySelectorAll('.theme-option').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`.theme-${themeName}`).classList.add('active');
      
      // Guardar preferencia
      localStorage.setItem('selectedTheme', themeName);
      
      // Actualizar meta theme-color
      const colors = {
        inacap: '#0066cc',
        green: '#059669',
        purple: '#7c3aed',
        red: '#dc2626'
      };
      
      document.querySelector('meta[name="theme-color"]').setAttribute('content', colors[themeName]);
      
      // Actualizar gr√°fico si existe
      if (currentPlot) {
        setTimeout(() => {
          Plotly.Plots.resize('grafico');
        }, 100);
      }
    }

    // Funciones avanzadas
    function toggleAdvanced() {
      const content = document.getElementById('advancedContent');
      const arrow = document.getElementById('advancedArrow');
      
      if (content.classList.contains('show')) {
        content.classList.remove('show');
        arrow.textContent = '‚ñº';
      } else {
        content.classList.add('show');
        arrow.textContent = '‚ñ≤';
      }
    }

    function updatePrecision(value) {
      currentPrecision = parseInt(value);
      const labels = ['Muy Baja', 'Baja', 'Baja', 'Est√°ndar', 'Est√°ndar', 'Est√°ndar', 'Alta', 'Alta', 'Muy Alta', 'M√°xima'];
      document.getElementById('precisionValue').textContent = labels[value - 1];
    }

    function toggleStatistics() {
      const panel = document.getElementById('statisticsPanel');
      panel.classList.toggle('show');
    }

    function resetAll() {
      clearForm();
      document.getElementById('statisticsPanel').classList.remove('show');
      document.getElementById('advancedContent').classList.remove('show');
      document.getElementById('advancedArrow').textContent = '‚ñº';
      currentPrecision = 5;
      document.getElementById('precisionSlider').value = 5;
      updatePrecision(5);
    }

    // Funci√≥n principal de c√°lculo mejorada
    document.getElementById('calculatorForm').addEventListener('submit', function(e) {
      e.preventDefault();
      calcular();
    });

    function calcular() {
      calculationStartTime = performance.now();
      
      const loadingEl = document.getElementById('loading');
      const resultadoEl = document.getElementById('resultado');
      const graficoContainer = document.getElementById('graficoContainer');
      const calculateBtn = document.getElementById('calculateBtn');
      
      calculateBtn.disabled = true;
      loadingEl.classList.add('active');
      resultadoEl.style.display = 'none';
      graficoContainer.style.display = 'none';
      clearMessages();

      try {
        const expr = document.getElementById('funcion').value.trim();
        const x0Input = document.getElementById('x0').value.trim();
        const unidadX = document.getElementById('unidadX').value.trim() || 'x';
        const unidadY = document.getElementById('unidadY').value.trim() || 'f(x)';

        if (!expr) throw new Error('Por favor ingresa una funci√≥n');
        if (!x0Input) throw new Error('Por favor ingresa el valor de x‚ÇÄ');

        // Evaluar x0
        let x0;
        try {
          x0 = math.evaluate(x0Input);
        } catch (error) {
          x0 = parseFloat(x0Input);
          if (isNaN(x0)) {
            throw new Error('El valor de x‚ÇÄ no es v√°lido. Usa n√∫meros o expresiones como œÄ/2');
          }
        }

        // Compilar funci√≥n
        const f = math.compile(expr);
        
        // Verificar funci√≥n v√°lida
        const testValue = f.evaluate({ x: x0 });
        if (!isFinite(testValue)) {
          throw new Error(`La funci√≥n no est√° definida en x‚ÇÄ = ${formatNumber(x0)}`);
        }

        // Calcular derivada con precisi√≥n ajustable
        const h = Math.pow(10, -(4 + currentPrecision));
        const f0 = f.evaluate({ x: x0 });
        
        let fp;
        try {
          const f_plus = f.evaluate({ x: x0 + h });
          const f_minus = f.evaluate({ x: x0 - h });
          fp = (f_plus - f_minus) / (2 * h);
          
          if (!isFinite(fp)) {
            const f_forward = f.evaluate({ x: x0 + h });
            fp = (f_forward - f0) / h;
          }
        } catch (error) {
          const f_forward = f.evaluate({ x: x0 + h });
          fp = (f_forward - f0) / h;
        }

        const m = fp;
        const b = f0 - m * x0;

        if (!isFinite(m) || !isFinite(b)) {
          throw new Error('No se pudo calcular la derivada en este punto');
        }

        calculationResult = { expr, x0, unidadX, unidadY, f, f0, fp, m, b };

        // Analizar funci√≥n para estad√≠sticas
        analyzeFunctionForStats(expr, x0, fp);

        // Generar resultados
        const resultado = generateDetailedResult();
        const interpretacion = generateAdvancedInterpretation();

        document.getElementById('resultadoContent').textContent = resultado;
        document.getElementById('interpretacionContent').textContent = interpretacion;

        // Generar gr√°fico
        setTimeout(() => {
          generarGrafico();
          
          loadingEl.classList.remove('active');
          resultadoEl.style.display = 'block';
          graficoContainer.style.display = 'block';
          calculateBtn.disabled = false;
          
          resultadoEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
          showSuccess('‚úÖ C√°lculo completado exitosamente');
          
          // Actualizar tiempo de c√°lculo
          const calculationTime = performance.now() - calculationStartTime;
          document.getElementById('statTime').textContent = `${calculationTime.toFixed(1)} ms`;
        }, 800);

      } catch (error) {
        loadingEl.classList.remove('active');
        calculateBtn.disabled = false;
        showError(error.message);
      }
    }

    function analyzeFunctionForStats(expr, x0, fp) {
      // Determinar tipo de funci√≥n
      let functionType = 'Polin√≥mica';
      if (expr.includes('sin') || expr.includes('cos') || expr.includes('tan')) {
        functionType = 'Trigonom√©trica';
      } else if (expr.includes('exp') || expr.includes('log')) {
        functionType = 'Exponencial/Logar√≠tmica';
      } else if (expr.includes('sqrt')) {
        functionType = 'Radical';
      }
      
      // Determinar comportamiento
      let behavior = fp > 0 ? 'Creciente' : fp < 0 ? 'Decreciente' : 'Constante';
      
      // Estimar curvatura (segunda derivada aproximada)
      const h = 1e-6;
      let curvature = 'No determinada';
      try {
        const f = math.compile(expr);
        const f_plus = (f.evaluate({ x: x0 + h }) - f.evaluate({ x: x0 })) / h;
        const f_minus = (f.evaluate({ x: x0 }) - f.evaluate({ x: x0 - h })) / h;
        const secondDerivative = (f_plus - f_minus) / h;
        
        if (Math.abs(secondDerivative) < 1e-6) {
          curvature = 'Recta (curvatura = 0)';
        } else if (secondDerivative > 0) {
          curvature = 'C√≥ncava hacia arriba';
        } else {
          curvature = 'C√≥ncava hacia abajo';
        }
      } catch (error) {
        curvature = 'No calculable';
      }
      
      // Precisi√≥n estimada
      const precisionLabels = ['Muy Baja (¬±0.1)', 'Baja (¬±0.01)', 'Est√°ndar (¬±0.001)', 'Alta (¬±0.0001)', 'Muy Alta (¬±0.00001)'];
      const precisionIndex = Math.min(Math.floor(currentPrecision / 2), precisionLabels.length - 1);
      
      document.getElementById('statFunctionType').textContent = functionType;
      document.getElementById('statBehavior').textContent = behavior;
      document.getElementById('statCurvature').textContent = curvature;
      document.getElementById('statPrecision').textContent = precisionLabels[precisionIndex];
    }

    function generateDetailedResult() {
      const { expr, x0, unidadX, unidadY, f0, fp, m, b } = calculationResult;
      
      return `üìå ECUACI√ìN LINEAL:\n   y = ${formatNumber(m)}x + ${formatNumber(b)}\n\n` +
             `üìç PUNTO DE EVALUACI√ìN:\n   f(${formatNumber(x0)}) = ${formatNumber(f0)}\n\n` +
             `üìà DERIVADA (PENDIENTE):\n   f'(${formatNumber(x0)}) ‚âà ${formatNumber(fp)}\n\n` +
             `üìè UNIDADES:\n   [${unidadY}] por [${unidadX}]\n\n` +
             `üìê ECUACI√ìN PUNTO-PENDIENTE:\n   y - ${formatNumber(f0)} = ${formatNumber(fp)}(x - ${formatNumber(x0)})\n\n` +
             `‚úÖ Aproximaci√≥n v√°lida cerca de x‚ÇÄ = ${formatNumber(x0)}`;
    }

    function generateAdvancedInterpretation() {
      const { expr, x0, fp, f0 } = calculationResult;
      const absDerivative = Math.abs(fp);
      
      let interpretation = '';
      
      if (absDerivative < 1e-6) {
        interpretation = `üîÑ AN√ÅLISIS: Punto cr√≠tico detectado\n\n`;
        interpretation += `‚Ä¢ La funci√≥n f(x) = ${expr} tiene un punto cr√≠tico en x = ${formatNumber(x0)}\n`;
        interpretation += `‚Ä¢ La recta tangente es horizontal (pendiente ‚âà 0)\n`;
        interpretation += `‚Ä¢ Posible m√°ximo local, m√≠nimo local o punto de inflexi√≥n\n`;
        interpretation += `‚Ä¢ La aproximaci√≥n lineal es y ‚âà ${formatNumber(f0)} (constante)`;
      } else if (fp > 0) {
        interpretation = `üìà AN√ÅLISIS: Funci√≥n creciente\n\n`;
        interpretation += `‚Ä¢ La funci√≥n f(x) = ${expr} est√° creciendo en x = ${formatNumber(x0)}\n`;
        interpretation += `‚Ä¢ Tasa de cambio instant√°nea: ${formatNumber(fp)} unidades por unidad de x\n`;
        interpretation += `‚Ä¢ Para peque√±os incrementos Œîx, el cambio aproximado es: Œîy ‚âà ${formatNumber(fp)} √ó Œîx\n`;
        interpretation += `‚Ä¢ La aproximaci√≥n lineal subestima/sobreestima seg√∫n la curvatura`;
      } else {
        interpretation = `üìâ AN√ÅLISIS: Funci√≥n decreciente\n\n`;
        interpretation += `‚Ä¢ La funci√≥n f(x) = ${expr} est√° decreciendo en x = ${formatNumber(x0)}\n`;
        interpretation += `‚Ä¢ Tasa de cambio instant√°nea: ${formatNumber(fp)} unidades por unidad de x\n`;
        interpretation += `‚Ä¢ Para peque√±os incrementos Œîx, el cambio aproximado es: Œîy ‚âà ${formatNumber(fp)} √ó Œîx\n`;
        interpretation += `‚Ä¢ La pendiente negativa indica decrecimiento local`;
      }
      
      interpretation += `\n\nüí° VALIDEZ:\n`;
      interpretation += `‚Ä¢ La aproximaci√≥n es m√°s precisa cerca de x‚ÇÄ\n`;
      interpretation += `‚Ä¢ Error t√≠pico: O((x-x‚ÇÄ)¬≤) para |x-x‚ÇÄ| peque√±o\n`;
      interpretation += `‚Ä¢ Nivel de precisi√≥n actual: ${document.getElementById('precisionValue').textContent}`;
      
      return interpretation;
    }

    function generarGrafico() {
      const { expr, x0, unidadX, unidadY, f, m, b } = calculationResult;
      
      let range = Math.max(2, Math.abs(x0) * 0.8);
      if (expr.includes('log') && x0 <= range) {
        range = Math.max(x0 + 2, 3);
      }
      
      const xMin = x0 - range;
      const xMax = x0 + range;
      const step = (xMax - xMin) / 300; // Mayor resoluci√≥n

      const xVals = [];
      const yVals = [];
      const yTangente = [];

      for (let x = xMin; x <= xMax; x += step) {
        try {
          const y = f.evaluate({ x });
          if (isFinite(y)) {
            xVals.push(x);
            yVals.push(y);
            yTangente.push(m * x + b);
          }
        } catch (error) {
          // Omitir puntos problem√°ticos
        }
      }

      // Trazas con colores INACAP
      const trace1 = {
        x: xVals,
        y: yVals,
        type: 'scatter',
        mode: 'lines',
        name: `f(x) = ${expr}`,
        line: { color: '#0066cc', width: 3 }
      };

      const trace2 = {
        x: xVals,
        y: yTangente,
        type: 'scatter',
        mode: 'lines',
        name: `Linealizaci√≥n`,
        line: { dash: 'dash', color: '#ff6600', width: 3 }
      };

      const trace3 = {
        x: [x0],
        y: [calculationResult.f0],
        type: 'scatter',
        mode: 'markers',
        name: `Punto (${formatNumber(x0)}, ${formatNumber(calculationResult.f0)})`,
        marker: { 
          size: 14, 
          color: '#ff6600',
          line: { width: 3, color: '#0066cc' }
        }
      };

      const layout = {
        title: {
          text: `Linealizaci√≥n de f(x) = ${expr} | INACAP`,
          font: { size: window.innerWidth < 768 ? 14 : 16, color: '#0066cc' }
        },
        xaxis: { 
          title: `x (${unidadX})`,
          showgrid: true,
          gridcolor: document.body.classList.contains('dark-mode') ? '#404040' : '#e1e5e9'
        },
        yaxis: { 
          title: `f(x) (${unidadY})`,
          showgrid: true,
          gridcolor: document.body.classList.contains('dark-mode') ? '#404040' : '#e1e5e9'
        },
        legend: { 
          orientation: 'h',
          y: -0.15,
          font: { size: window.innerWidth < 768 ? 10 : 12 }
        },
        margin: { l: 50, r: 20, t: 60, b: 90 },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        responsive: true,
        autosize: true
      };

      const config = {
        responsive: true,
        displayModeBar: window.innerWidth > 768,
        displaylogo: false,
        modeBarButtonsToRemove: [
          'pan2d', 'select2d', 'lasso2d', 'autoScale2d', 
          'hoverClosestCartesian', 'hoverCompareCartesian'
        ]
      };

      Plotly.newPlot('grafico', [trace1, trace2, trace3], layout, config);
      currentPlot = { data: [trace1, trace2, trace3], layout, config };
    }

    // Funciones de exportaci√≥n
    function exportToPDF() {
      if (!calculationResult) return;
      
      // Crear contenido PDF (simulado)
      const content = generateDetailedResult() + '\n\n' + generateAdvancedInterpretation();
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `linealizacion_${calculationResult.expr.replace(/[^a-zA-Z0-9]/g, '_')}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      showSuccess('üìÑ Archivo exportado exitosamente');
    }

    function exportToCSV() {
      if (!currentPlot) return;
      
      const data = currentPlot.data[0]; // Datos de la funci√≥n original
      let csv = 'x,f(x),Linearizaci√≥n\n';
      
      for (let i = 0; i < data.x.length; i++) {
        csv += `${data.x[i]},${data.y[i]},${currentPlot.data[1].y[i]}\n`;
      }
      
      const blob = new<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Calculadora de linealizaci√≥n con series de Taylor - Universidad">
  <meta name="theme-color" content="#1e3a8a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Taylor Calc">
  
  <title>Calculadora Taylor - Universidad</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkNhbGN1bGFkb3JhIGRlIExpbmVhbGl6YWNpw7NuIFRheWxvciAtIFVuaXZlcnNpZGFkIiwKICAic2hvcnRfbmFtZSI6ICJUYXlsb3IgQ2FsYyIsCiAgImRlc2NyaXB0aW9uIjogIkhlcnJhbWllbnRhIGFjYWTDqW1pY2EgcGFyYSBjYWxjdWxhciB5IHZpc3VhbGl6YXIgbGEgbGluZWFsaXphY2nDs24gZGUgZnVuY2lvbmVzIiwKICAidmVyc2lvbiI6ICIyLjEuMCIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMWUzYThhIiwKICAidGhlbWVfY29sb3IiOiAiIzNiODJmNiIsCiAgIm9yaWVudGF0aW9uIjogInBvcnRyYWl0LXByaW1hcnkiLAogICJjYXRlZ29yaWVzIjogWyJlZHVjYXRpb24iLCAidXRpbGl0aWVzIiwgInByb2R1Y3Rpdml0eSJdLAogICJsYW5nIjogImVzIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRreUlpQm9aV2xuYUhROUlqRTVNaUlpSUhacFpYZENiM2c5SWpBZ01DQXhPVElnTVRreUlpQm1hV3hzUFNKdWIyNWxJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lQangwWlhoMElIZzlJalk0SWlCNVBTSTNPQ0lnWm05dWRDMW1ZVzFwYkhrOUlrRnlhV0ZzSUVKc1lXTnJJaUJtYjI1MExYTnBlbVU5SWpNNElpQm1hV3hzUFNJak1XVTBNR0U0WVNJZ2RHVjRkQzFoYm1Ob2IzSTlJbTFwWkdSc1pTSStRMkZzWTNWc1lXUnZjbUVnZEdGNWJHOXlQQzkwWlhoMFBqeDBaWGgwSUhnOUlqWTRJaUI1UFNJeE1EUWlJR1p2Ym5RdFptRnRhV3g1UFNKQmNtbGhiQ0lnWm05dWRDMXphWHBsUFNJeE5DSWdabWxzYkQwaUkzZG9hWFJsSWlCdmNHRmphWFI1UFNJd0xqa2lJSFJsZUhRdFlXNWphRzl5UFNKdGFXUmtiR1VpUGxWdWFYWmxjbk5wWkdGa1BDOTBaWGgwUGp3dmMzWm5QZz09IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfQogIF0KfQ==">
  
  <!-- Scripts externos -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Colores oficiales INACAP */
      --primary: #0066cc;
      --secondary: #004499;
      --accent: #ff6600;
      --success: #059669;
      --warning: #f59e0b;
      --danger: #dc2626;
      --info: #06b6d4;
      --light: #f8fafc;
      --dark: #0f172a;
      --inacap-blue: #0066cc;
      --inacap-orange: #ff6600;
      --inacap-dark-blue: #004499;
      --gradient: linear-gradient(135deg, var(--inacap-blue) 0%, var(--inacap-dark-blue) 100%);
      --gradient-accent: linear-gradient(45deg, var(--inacap-orange), #ff8533);
    }

    /* Temas de color alternativos */
    .theme-inacap {
      --primary: #0066cc;
      --secondary: #004499;
      --accent: #ff6600;
    }

    .theme-green {
      --primary: #059669;
      --secondary: #10b981;
      --accent: #f59e0b;
    }

    .theme-purple {
      --primary: #7c3aed;
      --secondary: #a855f7;
      --accent: #06b6d4;
    }

    .theme-red {
      --primary: #dc2626;
      --secondary: #ef4444;
      --accent: #fbbf24;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--gradient);
      min-height: 100vh;
      color: #333;
      padding: 10px;
      transition: all 0.3s ease;
      overflow-x: hidden;
    }

    .dark-mode {
      background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
      color: #f4f4f4;
    }

    .container {
      max-width: 420px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dark-mode .container {
      background: rgba(30, 30, 30, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header {
      text-align: center;
      margin-bottom: 25px;
      padding: 20px;
      background: var(--gradient);
      border-radius: 15px;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: shimmer 4s infinite linear;
    }

    @keyframes shimmer {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .university-logo {
      width: 60px;
      height: 60px;
      margin: 0 auto 10px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 1;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      overflow: hidden;
    }

    .university-logo img {
      width: 45px;
      height: 45px;
      object-fit: contain;
    }

    .inacap-letters {
      font-family: 'Arial Black', Arial, sans-serif;
      font-weight: 900;
      font-size: 16px;
      color: var(--inacap-blue);
      letter-spacing: -1px;
    }

    .header h1 {
      font-size: 1.6rem;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
      font-weight: 700;
    }

    .header p {
      font-size: 0.9rem;
      opacity: 0.95;
      position: relative;
      z-index: 1;
    }

    .university-info {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-top: 5px;
      position: relative;
      z-index: 1;
    }

    /* Theme selector */
    .theme-selector {
      margin-bottom: 20px;
      text-align: center;
    }

    .theme-selector label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
      font-size: 0.9rem;
    }

    .dark-mode .theme-selector label {
      color: #ccc;
    }

    .theme-options {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .theme-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 3px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .theme-option.active {
      border-color: var(--accent);
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .theme-inacap { background: linear-gradient(45deg, #0066cc, #ff6600); }
    .theme-green { background: linear-gradient(45deg, #059669, #10b981); }
    .theme-purple { background: linear-gradient(45deg, #7c3aed, #a855f7); }
    .theme-red { background: linear-gradient(45deg, #dc2626, #ef4444); }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
      font-size: 0.95rem;
    }

    .dark-mode .form-group label {
      color: #ccc;
    }

    .input-container {
      position: relative;
    }

    .form-group input {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f8f9fa;
      -webkit-appearance: none;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
      background: white;
      box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
      transform: translateY(-1px);
    }

    .dark-mode .form-group input {
      background: #2a2a2a;
      border-color: #404040;
      color: #f4f4f4;
    }

    .dark-mode .form-group input:focus {
      border-color: var(--primary);
      background: #333;
    }

    .function-examples {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      justify-content: center;
    }

    .example-btn {
      padding: 8px 14px;
      background: #e9ecef;
      border: none;
      border-radius: 20px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s ease;
      color: #495057;
      font-weight: 500;
    }

    .example-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .dark-mode .example-btn {
      background: #404040;
      color: #ccc;
    }

    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    .btn {
      flex: 1;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: var(--gradient);
      color: white;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-warning {
      background: var(--warning);
      color: #212529;
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .result-section {
      margin-top: 25px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 15px;
      border-left: 4px solid var(--primary);
      animation: fadeIn 0.5s ease;
    }

    .dark-mode .result-section {
      background: #2a2a2a;
      border-left-color: var(--secondary);
    }

    .result-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .dark-mode .result-title {
      color: var(--secondary);
    }

    .result-content {
      font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
      background: white;
      padding: 16px;
      border-radius: 10px;
      white-space: pre-wrap;
      font-size: 0.9rem;
      line-height: 1.5;
      border: 1px solid #e1e5e9;
    }

    .dark-mode .result-content {
      background: #333;
      border-color: #404040;
      color: #f4f4f4;
    }

    .graph-container {
      margin-top: 25px;
      background: white;
      border-radius: 15px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.5s ease 0.2s both;
    }

    .dark-mode .graph-container {
      background: #2a2a2a;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 30px;
    }

    .loading.active {
      display: block;
      animation: pulse 1.5s infinite;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .advanced-options {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }

    .advanced-toggle {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      justify-content: center;
    }

    .advanced-content {
      margin-top: 15px;
      display: none;
    }

    .advanced-content.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .precision-slider {
      margin: 15px 0;
    }

    .precision-slider input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      height: 6px;
      border-radius: 3px;
      background: rgba(255,255,255,0.3);
      outline: none;
    }

    .precision-slider input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
    }

    .statistics-panel {
      background: var(--gradient-accent);
      color: #333;
      border-radius: 12px;
      padding: 15px;
      margin-top: 20px;
      display: none;
    }

    .statistics-panel.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .export-options {
      display: flex;
      gap: 8px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .export-btn {
      flex: 1;
      min-width: 100px;
      padding: 10px;
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.85rem;
    }

    .export-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-1px);
    }

    /* Responsive Design */
    @media (max-width: 480px) {
      .container {
        margin: 5px;
        padding: 15px;
      }

      .btn-group {
        flex-direction: column;
      }

      .theme-options {
        gap: 8px;
      }

      .theme-option {
        width: 35px;
        height: 35px;
      }

      .export-options {
        flex-direction: column;
      }
    }

    @media (orientation: landscape) and (max-height: 500px) {
      .header {
        padding: 10px;
        margin-bottom: 10px;
      }
      
      .university-logo {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="university-logo" id="universityLogo">
        <div class="inacap-letters">INACAP</div>
      </div>
      <h1>Calculadora Taylor</h1>
      <p>Linealizaci√≥n de funciones matem√°ticas</p>
      <div class="university-info" id="universityInfo">
        INACAP - Instituto Nacional de Capacitaci√≥n Profesional
      </div>
    </div>

    <!-- Selector de tema -->
    <div class="theme-selector">
      <label>üé® Personalizar colores:</label>
      <div class="theme-options">
        <div class="theme-option theme-inacap active" onclick="changeTheme('inacap')" title="Colores INACAP Oficiales"></div>
        <div class="theme-option theme-green" onclick="changeTheme('green')" title="Verde Tecnol√≥gico"></div>
        <div class="theme-option theme-purple" onclick="changeTheme('purple')" title="P√∫rpura Moderno"></div>
        <div class="theme-option theme-red" onclick="changeTheme('red')" title="Rojo Universitario"></div>
      </div>
    </div>

    <!-- Opciones avanzadas -->
    <div class="advanced-options">
      <button class="advanced-toggle" onclick="toggleAdvanced()">
        <span>‚öôÔ∏è Opciones Avanzadas</span>
        <span id="advancedArrow">‚ñº</span>
      </button>
      <div class="advanced-content" id="advancedContent">
        <div class="precision-slider">
          <label style="color: white; font-size: 0.85rem;">Precisi√≥n del c√°lculo:</label>
          <input type="range" id="precisionSlider" min="1" max="10" value="5" oninput="updatePrecision(this.value)">
          <div style="color: rgba(255,255,255,0.8); font-size: 0.8rem; text-align: center;">
            <span id="precisionValue">Est√°ndar</span>
          </div>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
          <button class="export-btn" onclick="toggleStatistics()">üìä Estad√≠sticas</button>
          <button class="export-btn" onclick="resetAll()">üîÑ Reiniciar</button>
        </div>
      </div>
    </div>

    <form id="calculatorForm">
      <div class="form-group">
        <label for="funcion">üî¢ Funci√≥n f(x):</label>
        <div class="input-container">
          <input type="text" id="funcion" placeholder="Ingresa tu funci√≥n..." required autocomplete="off">
        </div>
        <div class="function-examples">
          <button type="button" class="example-btn" onclick="setFunction('sin(x)')">sin(x)</button>
          <button type="button" class="example-btn" onclick="setFunction('cos(x)')">cos(x)</button>
          <button type="button" class="example-btn" onclick="setFunction('x^2')">x¬≤</button>
          <button type="button" class="example-btn" onclick="setFunction('exp(x)')">eÀ£</button>
          <button type="button" class="example-btn" onclick="setFunction('log(x)')">ln(x)</button>
          <button type="button" class="example-btn" onclick="setFunction('sqrt(x)')">‚àöx</button>
          <button type="button" class="example-btn" onclick="setFunction('tan(x)')">tan(x)</button>
          <button type="button" class="example-btn" onclick="setFunction('1/x')">1/x</button>
        </div>
      </div>

      <div class="form-group">
        <label for="x0">üìç Punto de linealizaci√≥n x‚ÇÄ:</label>
        <input type="text" id="x0" placeholder="Ej: 0, 1, pi/2..." required autocomplete="off">
      </div>

      <div class="form-group">
        <label for="unidadX">üìè Unidad de x (opcional):</label>
        <input type="text" id="unidadX" placeholder="Ej: s, m, ¬∞, rad" autocomplete="off">
      </div>

      <div class="form-group">
        <label for="unidadY">üìê Unidad de f(x) (opcional):</label>
        <input type="text" id="unidadY" placeholder="Ej: m, kg, V, N" autocomplete="off">
      </div>

      <div class="btn-group">
        <button type="submit" class="btn btn-primary" id="calculateBtn">
          <span>üßÆ Calcular</span>
        </button>
        <button type="button" class="btn btn-secondary" onclick="clearForm()">
          <span>üóëÔ∏è Limpiar</span>
        </button>
      </div>
    </form>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Calculando linealizaci√≥n...</p>
    </div>

    <!-- Panel de estad√≠sticas -->
    <div class="statistics-panel" id="statisticsPanel">
      <h3 style="margin-bottom: 15px;">üìä Estad√≠sticas del C√°lculo</h3>
      <div class="stat-item">
        <span>Tipo de funci√≥n:</span>
        <span id="statFunctionType">-</span>
      </div>
      <div class="stat-item">
        <span>Comportamiento:</span>
        <span id="statBehavior">-</span>
      </div>
      <div class="stat-item">
        <span>Curvatura:</span>
        <span id="statCurvature">-</span>
      </div>
      <div class="stat-item">
        <span>Precisi√≥n estimada:</span>
        <span id="statPrecision">-</span>
      </div>
      <div class="stat-item">
        <span>Tiempo de c√°lculo:</span>
        <span id="statTime">-</span>
      </div>
    </div>

    <div id="resultado" style="display: none;">
      <div class="result-section">
        <div class="result-title">
          <span>üìã</span>
          <span>Ecuaci√≥n Lineal</span>
        </div>
        <div class="result-content" id="resultadoContent"></div>
      </div>

      <div class="result-section">
        <div class="result-title">
          <span>üß†</span>
          <span>Interpretaci√≥n Matem√°tica</span>
        </div>
        <div class="result-content" id="interpretacionContent"></div>
      </div>

      <div class="export-options">
        <button class="export-btn" onclick="descargarGrafico()">üì• PNG</button>
        <button class="export-btn" onclick
